<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="description" content="Personal Blog">
  <title>Python collections | linw1995</title>
  <link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png">
  <link rel="alternate" type="application/atom+xml" href="/atom.xml">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-86170223-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

<body>
  <div class="body_container">
    <div id="header">
      <div class="site-name">
        <h1 class="hidden">Python collections</h1><a id="logo" href="/.">linw1995</a>
        <p class="description"></p>
      </div>
      <div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div>
    </div>
    <div id="layout" class="pure-g">
      <div class="pure-u-1 pure-u-md-4-4">
        <div class="content_container">
          <div class="post">
            <h1 class="post-title">Python collections</h1>
            <div class="post-meta">Mar 30, 2017<span> | </span><span class="category"><a href="/categories/Python/">Python</a></span>
              <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span>
            </div>
            <a data-disqus-identifier="2017/03/30/Python-collections/" href="/2017/03/30/Python-collections/#disqus_thread" class="disqus-comment-count"></a>
            <div class="clear">
              <div id="toc" class="toc-article">
                <div class="toc-title">Contents</div>
                <ol class="toc">
                  <li class="toc-item toc-level-1"><a class="toc-link" href="#py2与py3的区别"><span class="toc-number">1.</span> <span class="toc-text">
  py2与py3的区别</span></a></li>
                  <li class="toc-item toc-level-1"><a class="toc-link" href="#同"><span class="toc-number">2.</span> <span class="toc-text">
  同</span></a>
                    <ol class="toc-child">
                      <li class="toc-item toc-level-2"><a class="toc-link" href="#Counter"><span class="toc-number">2.1.</span> <span class="toc-text">
  Counter</span></a>
                        <ol class="toc-child">
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#methods"><span class="toc-number">2.1.1.</span> <span class="toc-text">
  methods</span></a></li>
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#其它用法"><span class="toc-number">2.1.2.</span> <span class="toc-text">
  其它用法</span></a></li>
                        </ol>
                      </li>
                      <li class="toc-item toc-level-2"><a class="toc-link" href="#deque"><span class="toc-number">2.2.</span> <span class="toc-text">
  deque</span></a>
                        <ol class="toc-child">
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#特殊方法"><span class="toc-number">2.2.1.</span> <span class="toc-text">
  特殊方法</span></a></li>
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#用deque来实现移动平均"><span class="toc-number">2.2.2.</span> <span class="toc-text">
  用deque来实现移动平均</span></a></li>
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#使用rotate来删除deque中的某个甚至多个元素"><span class="toc-number">2.2.3.</span> <span class="toc-text">
  使用rotate来删除deque中的某个甚至多个元素</span></a></li>
                        </ol>
                      </li>
                      <li class="toc-item toc-level-2"><a class="toc-link" href="#defaultdict"><span class="toc-number">2.3.</span> <span class="toc-text">
  defaultdict</span></a>
                        <ol class="toc-child">
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#missing-factory-function"><span class="toc-number">2.3.1.</span> <span class="toc-text">
  missing factory function</span></a></li>
                        </ol>
                      </li>
                      <li class="toc-item toc-level-2"><a class="toc-link" href="#namedtuple"><span class="toc-number">2.4.</span> <span class="toc-text">
  namedtuple</span></a>
                        <ol class="toc-child">
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#特殊方法-1"><span class="toc-number">2.4.1.</span> <span class="toc-text">
  特殊方法</span></a></li>
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#用namedtuple做父类"><span class="toc-number">2.4.2.</span> <span class="toc-text">
  用namedtuple做父类</span></a></li>
                        </ol>
                      </li>
                      <li class="toc-item toc-level-2"><a class="toc-link" href="#OrderedDict"><span class="toc-number">2.5.</span> <span class="toc-text">
  OrderedDict</span></a>
                        <ol class="toc-child">
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#有趣的例子"><span class="toc-number">2.5.1.</span> <span class="toc-text">
  有趣的例子</span></a></li>
                        </ol>
                      </li>
                      <li class="toc-item toc-level-2"><a class="toc-link" href="#UserList-UserDict-UserString"><span class="toc-number">2.6.</span> <span class="toc-text">
  UserList, UserDict, UserString</span></a></li>
                    </ol>
                  </li>
                  <li class="toc-item toc-level-1"><a class="toc-link" href="#异"><span class="toc-number">3.</span> <span class="toc-text">
  异</span></a>
                    <ol class="toc-child">
                      <li class="toc-item toc-level-2"><a class="toc-link" href="#ChainMap"><span class="toc-number">3.1.</span> <span class="toc-text">
  ChainMap</span></a>
                        <ol class="toc-child">
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#methods-1"><span class="toc-number">3.1.1.</span> <span class="toc-text">
  methods</span></a></li>
                          <li class="toc-item toc-level-3"><a class="toc-link" href="#DeepChainMap"><span class="toc-number">3.1.2.</span> <span class="toc-text">
  DeepChainMap</span></a></li>
                        </ol>
                      </li>
                    </ol>
                  </li>
                  <li class="toc-item toc-level-1"><a class="toc-link" href="#参考链接"><span class="toc-number">4.</span> <span class="toc-text">
  参考链接</span></a></li>
                </ol>
              </div>
            </div>
            <div class="post-content">
              <p><strong>Python</strong>内置了一组高性能的容器类型，满足了所有基本的需求，<br>这个库就叫做<strong>collections</strong><br>
                <a id="more"></a>
              </p>
              <h1 id="py2与py3的区别">
                <a href="#py2与py3的区别" class="headerlink" title="py2与py3的区别"></a>py2与py3的区别</h1>
              <blockquote>
                <p>注意：<br>在<strong>py2.7</strong>中<strong>UserDict</strong>, <strong>UserList</strong>, <strong>UserString</strong>为单独的模块，不在<strong>collections</strong>中。<br>由于<strong>Abstract Base Classes</strong>在<strong>py3</strong>中迁移到<strong>collections.abc</strong>中，加上<strong>abc</strong>很复杂，本文先不归纳。</p>
              </blockquote>
              <table>
                <thead>
                  <tr>
                    <th>类型</th>
                    <th style="text-align:center">py2</th>
                    <th style="text-align:center">py3</th>
                    <th>描述</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>namedtuple</td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>factory function for creating tuple subclasses with named fields.</td>
                  </tr>
                  <tr>
                    <td>deque</td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>list-like container with fast appends and pops on either end.</td>
                  </tr>
                  <tr>
                    <td>Counter</td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>dict subclass for counting hashable objects.</td>
                  </tr>
                  <tr>
                    <td>OrderedDict</td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>dict subclass that remembers the order entries were added.</td>
                  </tr>
                  <tr>
                    <td>defaultdict</td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>dict subclass that calls a factory function to supply missing values.</td>
                  </tr>
                  <tr>
                    <td>ChainMap</td>
                    <td style="text-align:center"><span style="color:red">✘</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>dict-like class for creating a single view of multiple mappings.</td>
                  </tr>
                  <tr>
                    <td>UserDict</td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>wrapper around dictionary objects for easier dict subclassing.</td>
                  </tr>
                  <tr>
                    <td>UserList</td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>wrapper around list objects for easier list subclassing.</td>
                  </tr>
                  <tr>
                    <td>UserString</td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td style="text-align:center"><span style="color:green">✔</span></td>
                    <td>wrapper around string objects for easier string subclassing.</td>
                  </tr>
                </tbody>
              </table>
              <h1 id="同">
                <a href="#同" class="headerlink" title="同"></a>同</h1>
              <h2 id="Counter">
                <a href="#Counter" class="headerlink" title="Counter"></a>Counter</h2>
              <p>一个方便快捷的计数工具，基于<strong>dict</strong>类，可对<strong>hashable</strong>对象进行计数。</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = Counter()                           <span class="comment"># a new, empty counter</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = Counter(<span class="string">'gallahad'</span>)                 <span class="comment"># a new counter from an iterable</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = Counter(&#123;<span class="string">'red'</span>: <span class="number">4</span>, <span class="string">'blue'</span>: <span class="number">2</span>&#125;)      <span class="comment"># a new counter from a mapping</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = Counter(cats=<span class="number">4</span>, dogs=<span class="number">8</span>)             <span class="comment"># a new counter from keyword args</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = Counter([<span class="string">'eggs'</span>, <span class="string">'ham'</span>])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c[<span class="string">'bacon'</span>]                              <span class="comment"># count of a missing element is zero</span></div><div class="line"><span class="number">0</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c[<span class="string">'sausage'</span>] = <span class="number">0</span>                        <span class="comment"># counter entry with a zero count</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> c[<span class="string">'sausage'</span>]                        <span class="comment"># del actually removes the entry</span></div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="methods">
                <a href="#methods" class="headerlink" title="methods"></a>methods</h3>
              <ol>
                <li>
                  <p><strong>elements()</strong>， 返回一个根据元素的计数重复元素的迭代器。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = Counter(a=<span class="number">4</span>, b=<span class="number">2</span>, c=<span class="number">0</span>, d=<span class="number">-2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(c.elements())</div><div class="line">[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>]</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><strong>most_common(n)</strong>，返回n个计数最多的元素， 返回数组，数组元素为(counted_object, count)。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Counter(<span class="string">'abracadabra'</span>).most_common(<span class="number">3</span>)</div><div class="line">[(<span class="string">'a'</span>, <span class="number">5</span>), (<span class="string">'r'</span>, <span class="number">2</span>), (<span class="string">'b'</span>, <span class="number">2</span>)]</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><strong>subtract([iterable-or-mapping])</strong>，非常像<strong>dict.update</strong>，但不是覆盖旧记录，而是减去（保持为整数）。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = Counter(a=<span class="number">4</span>, b=<span class="number">2</span>, c=<span class="number">0</span>, d=<span class="number">-2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = Counter(a=<span class="number">1</span>, b=<span class="number">2</span>, c=<span class="number">3</span>, d=<span class="number">4</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c.subtract(d)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c</div><div class="line">Counter(&#123;<span class="string">'a'</span>: <span class="number">3</span>, <span class="string">'b'</span>: <span class="number">0</span>, <span class="string">'c'</span>: <span class="number">-3</span>, <span class="string">'d'</span>: <span class="number">-6</span>&#125;)</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><strong>update([iterable-or-mapping])</strong>，等同于<strong>dict.update</strong>，覆盖掉旧记录。</p>
                </li>
              </ol>
              <h3 id="其它用法">
                <a href="#其它用法" class="headerlink" title="其它用法"></a>其它用法</h3>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = Counter(a=<span class="number">3</span>, b=<span class="number">1</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = Counter(a=<span class="number">1</span>, b=<span class="number">2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c + d                       <span class="comment"># add two counters together:  c[x] + d[x]</span></div><div class="line">Counter(&#123;<span class="string">'a'</span>: <span class="number">4</span>, <span class="string">'b'</span>: <span class="number">3</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c - d                       <span class="comment"># subtract (keeping only positive counts)</span></div><div class="line">Counter(&#123;<span class="string">'a'</span>: <span class="number">2</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c &amp; d                       <span class="comment"># intersection:  min(c[x], d[x])</span></div><div class="line">Counter(&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">1</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c | d                       <span class="comment"># union:  max(c[x], d[x])</span></div><div class="line">Counter(&#123;<span class="string">'a'</span>: <span class="number">3</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h2 id="deque">
                <a href="#deque" class="headerlink" title="deque"></a>deque</h2>
              <p>双向队列，支持方法多数与<strong>list</strong>一致，<br><strong>append</strong>, <strong>clear</strong>, <strong>count</strong>, <strong>extend</strong>, <strong>pop</strong>, <strong>remove</strong>, <strong>reverse</strong></p>
              <h3 id="特殊方法">
                <a href="#特殊方法" class="headerlink" title="特殊方法"></a>特殊方法</h3>
              <ol>
                <li><strong>appendleft(x)</strong></li>
                <li><strong>extendleft(x)</strong></li>
                <li><strong>popleft()</strong></li>
                <li>
                  <p><strong>rotate(n)</strong>，轮转n个位置</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>d</div><div class="line">deque([<span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d.rotate(<span class="number">1</span>)                      <span class="comment"># right rotation</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d</div><div class="line">deque([<span class="string">'l'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d.rotate(<span class="number">-1</span>)                     <span class="comment"># left rotation</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d</div><div class="line">deque([<span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>])</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><strong>maxlen</strong>，<strong>deque</strong>的最大长度</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">tail</span><span class="params">(filename, n=<span class="number">10</span>)</span>:</span></div><div class="line">    <span class="string">'Return the last n lines of a file'</span></div><div class="line">    <span class="keyword">return</span> deque(open(filename), maxlen=n)</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
              </ol>
              <h3 id="用deque来实现移动平均">
                <a href="#用deque来实现移动平均" class="headerlink" title="用deque来实现移动平均"></a>用deque来实现移动平均</h3>
              <blockquote>
                <p>Wiki:<a href="https://en.wikipedia.org/wiki/Moving_average" target="_blank" rel="external">Moving average</a></p>
              </blockquote>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">moving_average</span><span class="params">(iterable, n=<span class="number">3</span>)</span>:</span></div><div class="line">    it = iter(iterable)</div><div class="line">    d = deque(itertools.islice(it, n<span class="number">-1</span>))</div><div class="line">    d.appendleft(<span class="number">0</span>)</div><div class="line">    s = sum(d)</div><div class="line">    <span class="keyword">for</span> elem <span class="keyword">in</span> it:</div><div class="line">        s += elem - d.popleft()</div><div class="line">        d.append(elem)</div><div class="line">        <span class="keyword">yield</span> s / float(n)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="使用rotate来删除deque中的某个甚至多个元素">
                <a href="#使用rotate来删除deque中的某个甚至多个元素" class="headerlink" title="使用rotate来删除deque中的某个甚至多个元素"></a>使用rotate来删除deque中的某个甚至多个元素</h3>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">deleted</span><span class="params">(d, start, end=None, step=None)</span>:</span></div><div class="line">    d = deque(d)</div><div class="line">    end = end <span class="keyword">or</span> start + <span class="number">1</span></div><div class="line">    size = abs(end - start)</div><div class="line">    count = <span class="number">0</span></div><div class="line">    d.rotate(-start)</div><div class="line">    diff = start</div><div class="line">    <span class="keyword">while</span> count &lt; size:</div><div class="line">        d.popleft()</div><div class="line">        <span class="keyword">if</span> step:</div><div class="line">            d.rotate(-step)</div><div class="line">            diff += step</div><div class="line">        count += <span class="number">1</span></div><div class="line">    d.rotate(diff)</div><div class="line">    <span class="keyword">return</span> d</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = deque(range(<span class="number">10</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d</div><div class="line">deque([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>deleted(d, <span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>)</div><div class="line">deque([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>])</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h2 id="defaultdict">
                <a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h2>
              <p>用函数为<strong>missing key</strong>提供一个默认值，以<strong>dict</strong>为基类的特殊字典。<br>其实与dict的区别就是多了个<strong><strong>missing</strong>(key)</strong>方法</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> UserDict</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDefaultDict</span><span class="params">(UserDict)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__missing__</span><span class="params">(self, key)</span>:</span></div><div class="line">        self[key] = <span class="number">0</span></div><div class="line">        <span class="keyword">return</span> self[key]</div><div class="line"></div><div class="line">d = MyDefaultDict()</div><div class="line">d[<span class="string">"abc"</span>] <span class="comment"># 0</span></div><div class="line">d <span class="comment"># &#123;'abc': 0&#125;</span></div><div class="line">d[<span class="string">"defg"</span>] += <span class="number">1</span></div><div class="line">d <span class="comment"># &#123;'abc': 0, 'defg': 1&#125;</span></div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>和<strong>default_factory</strong>这个函数，用来初始化<em>missing key*</em>的值。</p>
              <p>虽然道理很简单，但是还是用内置的<strong>defaultdict</strong>最好。<br>就算要定制自己的<strong>defaultdict</strong>, 那一定要继承<strong>defaultdict</strong>或<strong>UserDict</strong>。</p>
              <blockquote>
                <ul>
                  <li><a href="http://www.dongwm.com/archives/UserDict%E3%80%81UserString%E3%80%81UserList%E5%AD%98%E5%9C%A8%E7%9A%84%E6%84%8F%E4%B9%89/" target="_blank" rel="external">UserDict、UserString、UserList存在的意义</a></li>
                  <li><a href="http://stackoverflow.com/questions/25464647/list-vs-userlist-and-dict-vs-userdict" target="_blank" rel="external">list vs UserList and dict vs UserDict [stackoverflow]</a> </li>
                </ul>
              </blockquote>
              <h3 id="missing-factory-function">
                <a href="#missing-factory-function" class="headerlink" title="missing factory function"></a>missing factory function</h3>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = [(<span class="string">'yellow'</span>, <span class="number">1</span>), (<span class="string">'blue'</span>, <span class="number">2</span>), (<span class="string">'yellow'</span>, <span class="number">3</span>), (<span class="string">'blue'</span>, <span class="number">4</span>), (<span class="string">'red'</span>, <span class="number">1</span>)]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = defaultdict(list)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> s:</div><div class="line"><span class="meta">... </span>    d[k].append(v)</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d.items()</div><div class="line">dict_items([(<span class="string">'blue'</span>, [<span class="number">2</span>, <span class="number">4</span>]), (<span class="string">'red'</span>, [<span class="number">1</span>]), (<span class="string">'yellow'</span>, [<span class="number">1</span>, <span class="number">3</span>])])</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>与<strong>dict.setdefault</strong>似乎差别不大</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = dict()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> s:</div><div class="line"><span class="meta">... </span>    d.setdefault(k, []).append(v)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d.items()</div><div class="line">dict_items([(<span class="string">'blue'</span>, [<span class="number">2</span>, <span class="number">4</span>]), (<span class="string">'red'</span>, [<span class="number">1</span>]), (<span class="string">'yellow'</span>, [<span class="number">1</span>, <span class="number">3</span>])])</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>其实，<strong>dict.setdefault</strong>用提供的变量来生成新值，而<strong>defaultdict</strong>使用函数来生成<strong>missing key</strong>的新值</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l = []</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> s:</div><div class="line"><span class="meta">... </span>    d.setdefault(k, l).append(v)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d.items()</div><div class="line">dict_items([(<span class="string">'yellow'</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>]), (<span class="string">'blue'</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>]), (<span class="string">'red'</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>])])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> random <span class="keyword">import</span> random</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = defaultdict(random)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> s:</div><div class="line"><span class="meta">... </span>    d[k] += v</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d.items()</div><div class="line">dict_items([(<span class="string">'yellow'</span>, <span class="number">4.3108967141731975</span>), (<span class="string">'blue'</span>, <span class="number">6.5111474260668025</span>), (<span class="string">'red'</span>, <span class="number">1.978881739541357</span>)])</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h2 id="namedtuple">
                <a href="#namedtuple" class="headerlink" title="namedtuple"></a>namedtuple</h2>
              <p>用来生成具有键值对的特殊元组，命名元组。</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Point = namedtuple(<span class="string">'Point'</span>, [<span class="string">'x'</span>, <span class="string">'y'</span>]) <span class="comment"># or namedtuple('Point', 'x y')</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(<span class="number">11</span>, y=<span class="number">22</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p</div><div class="line">Point(x=<span class="number">11</span>, y=<span class="number">22</span>)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>命名元组，其特性在某些情况下特别好用。<br>比如处理csv文件时, 计算重复行</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="keyword">import</span> csv</div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple, Counter</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">(file_name, encoding)</span>:</span></div><div class="line">    <span class="keyword">with</span> open(file_name, encoding=encoding) <span class="keyword">as</span> f:</div><div class="line">        f_csv = csv.reader(f)</div><div class="line">        Row = namedtuple(<span class="string">"Row"</span>, next(f_csv))</div><div class="line">        counter = Counter(map(<span class="keyword">lambda</span> r:Row(*r), f_csv))</div><div class="line">    <span class="keyword">return</span> counter</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="特殊方法-1">
                <a href="#特殊方法-1" class="headerlink" title="特殊方法"></a>特殊方法</h3>
              <ol>
                <li>
                  <p><strong>_asdict()</strong>，返回一个<strong>OrderedDict</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(x=<span class="number">11</span>, y=<span class="number">22</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p._asdict()</div><div class="line">OrderedDict([(<span class="string">'x'</span>, <span class="number">11</span>), (<span class="string">'y'</span>, <span class="number">22</span>)])</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><strong>_replace(kwargs)</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(x=<span class="number">11</span>, y=<span class="number">22</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p._replace(x=<span class="number">33</span>)</div><div class="line">Point(x=<span class="number">33</span>, y=<span class="number">22</span>)</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><strong>_fields</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>p._fields            <span class="comment"># view the field names</span></div><div class="line">(<span class="string">'x'</span>, <span class="string">'y'</span>)</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
              </ol>
              <h3 id="用namedtuple做父类">
                <a href="#用namedtuple做父类" class="headerlink" title="用namedtuple做父类"></a>用namedtuple做父类</h3>
              <p>命名元组其实就是一个<strong>python</strong>类，所以可以用来当父类</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="comment"># python2.7</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Point</span><span class="params">(namedtuple<span class="params">(<span class="string">'Point'</span>, <span class="string">'x y'</span>)</span>)</span>:</span></div><div class="line"><span class="meta">... </span>    __slots__ = ()</div><div class="line"><span class="meta">... </span>    @property</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">hypot</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> (self.x ** <span class="number">2</span> + self.y ** <span class="number">2</span>) ** <span class="number">0.5</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">'Point: x=%6.3f  y=%6.3f  hypot=%6.3f'</span> % (self.x, self.y, self.hypot)</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> p <span class="keyword">in</span> Point(<span class="number">3</span>, <span class="number">4</span>), Point(<span class="number">14</span>, <span class="number">5</span>/<span class="number">7.</span>):</div><div class="line"><span class="meta">... </span>    <span class="keyword">print</span> p</div><div class="line">Point: x= <span class="number">3.000</span>  y= <span class="number">4.000</span>  hypot= <span class="number">5.000</span></div><div class="line">Point: x=<span class="number">14.000</span>  y= <span class="number">0.714</span>  hypot=<span class="number">14.018</span></div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h2 id="OrderedDict">
                <a href="#OrderedDict" class="headerlink" title="OrderedDict"></a>OrderedDict</h2>
              <p>有序字典，除了键值对有序以外，<br>还比通常字典多了个<strong>popitem(last=True)</strong>的方法,<br>last=True, <strong>LIFO</strong><br>last=False, <strong>FIFO</strong></p>
              <h3 id="有趣的例子">
                <a href="#有趣的例子" class="headerlink" title="有趣的例子"></a>有趣的例子</h3>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LastUpdatedOrderedDict</span><span class="params">(OrderedDict)</span>:</span></div><div class="line">    <span class="string">'Store items in the order the keys were last added'</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></div><div class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self:</div><div class="line">            <span class="keyword">del</span> self[key]</div><div class="line">        OrderedDict.__setitem__(self, key, value)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderedCounter</span><span class="params">(Counter, OrderedDict)</span>:</span></div><div class="line">     <span class="string">'Counter that remembers the order elements are first encountered'</span></div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></div><div class="line">         <span class="keyword">return</span> <span class="string">'%s(%r)'</span> % (self.__class__.__name__, OrderedDict(self))</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></div><div class="line">         <span class="keyword">return</span> self.__class__, (OrderedDict(self),)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h2 id="UserList-UserDict-UserString">
                <a href="#UserList-UserDict-UserString" class="headerlink" title="UserList, UserDict, UserString"></a>UserList, UserDict, UserString</h2>
              <p>当需要自定<strong>list</strong>,<strong>dict</strong>,<strong>str</strong>类型时，推荐以上来当父类。</p>
              <blockquote>
                <ul>
                  <li><a href="http://www.dongwm.com/archives/UserDict%E3%80%81UserString%E3%80%81UserList%E5%AD%98%E5%9C%A8%E7%9A%84%E6%84%8F%E4%B9%89/" target="_blank" rel="external">UserDict、UserString、UserList存在的意义</a></li>
                  <li><a href="http://stackoverflow.com/questions/25464647/list-vs-userlist-and-dict-vs-userdict" target="_blank" rel="external">list vs UserList and dict vs UserDict [stackoverflow]</a> </li>
                </ul>
              </blockquote>
              <h1 id="异">
                <a href="#异" class="headerlink" title="异"></a>异</h1>
              <h2 id="ChainMap">
                <a href="#ChainMap" class="headerlink" title="ChainMap"></a>ChainMap</h2>
              <p>用来把<strong>mapping</strong>对象联合起来生成一个索引对象。</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> builtins</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>pylookup = ChainMap(locals(), globals(), vars(builtins))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">()</span>:</span></div><div class="line"><span class="meta">... </span>    print(<span class="string">"sum"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>pylookup[<span class="string">"sum"</span>]()</div><div class="line">sum</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> sum</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>pylookup[<span class="string">"sum"</span>].__doc__</div><div class="line"><span class="string">"Return the sum of a 'start' value (default: 0) plus an iterable of numbers\n\nWhen the iterable is empty, return the start value.\nThis function is intended specifically for use with numeric values and may\nreject non-numeric types."</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> pylookup[<span class="string">"sum"</span>]</div><div class="line">KeyError: <span class="string">"Key not found in the first mapping: 'sum'"</span></div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p><strong>ChainMap</strong>是按照被映射的顺序来搜索的，且只能修改第一个映射字典</p>
              <h3 id="methods-1">
                <a href="#methods-1" class="headerlink" title="methods"></a>methods</h3>
              <ol>
                <li>
                  <p><strong>maps</strong>，一个可修改的列表，存储映射顺序</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>len(pylookup.maps)</div><div class="line"><span class="number">3</span></div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><strong>new_child(m=None)</strong>，返回一个新的<strong>ChainMap</strong>。<br> 当m指定，则把指定的<strong>mapping</strong>对象插到映射顺序最前；<br>若m不指定，则创建一个新字典插到映射顺序最前， 像这样<code>ChainMap({}, *d.maps)</code>。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>n = pylookup.new_child()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>n.maps[<span class="number">0</span>]</div><div class="line">&#123;&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>n.maps[<span class="number">1</span>:] == pylookup.maps</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>n = pylookup.newchild(<span class="number">1</span>)</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><strong>parents</strong>，返回复制版本,除了映射顺序最前的对象，就像这样<code>ChainMap(*d.maps[1:])</code>。<br> 通常用来搜索，<strong>super()</strong>差不多是这样实现的。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre> </td>
                        <td class="code">
                          <pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>p = pylookup.parents</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p.maps == pylookup.maps[<span class="number">1</span>:]</div><div class="line"><span class="keyword">True</span></div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
              </ol>
              <h3 id="DeepChainMap">
                <a href="#DeepChainMap" class="headerlink" title="DeepChainMap"></a>DeepChainMap</h3>
              <p>通过继承<strong>ChainMap</strong>, 打破其限制</p>
              <figure class="highlight python">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeepChainMap</span><span class="params">(ChainMap)</span>:</span></div><div class="line">    <span class="string">'Variant of ChainMap that allows direct updates to inner scopes'</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></div><div class="line">        <span class="keyword">for</span> mapping <span class="keyword">in</span> self.maps:</div><div class="line">            <span class="keyword">if</span> key <span class="keyword">in</span> mapping:</div><div class="line">                mapping[key] = value</div><div class="line">                <span class="keyword">return</span></div><div class="line">        self.maps[<span class="number">0</span>][key] = value</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></div><div class="line">        <span class="keyword">for</span> mapping <span class="keyword">in</span> self.maps:</div><div class="line">            <span class="keyword">if</span> key <span class="keyword">in</span> mapping:</div><div class="line">                <span class="keyword">del</span> mapping[key]</div><div class="line">                <span class="keyword">return</span></div><div class="line">        <span class="keyword">raise</span> KeyError(key)</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = DeepChainMap(&#123;<span class="string">'zebra'</span>: <span class="string">'black'</span>&#125;, &#123;<span class="string">'elephant'</span>: <span class="string">'blue'</span>&#125;, &#123;<span class="string">'lion'</span>: <span class="string">'yellow'</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'lion'</span>] = <span class="string">'orange'</span>         <span class="comment"># update an existing key two levels down</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'snake'</span>] = <span class="string">'red'</span>           <span class="comment"># new keys get added to the topmost dict</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> d[<span class="string">'elephant'</span>]            <span class="comment"># remove an existing key one level down</span></div><div class="line">DeepChainMap(&#123;<span class="string">'zebra'</span>: <span class="string">'black'</span>, <span class="string">'snake'</span>: <span class="string">'red'</span>&#125;, &#123;&#125;, &#123;<span class="string">'lion'</span>: <span class="string">'orange'</span>&#125;)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h1 id="参考链接">
                <a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1>
              <blockquote class="pullquote">
                <ul>
                  <li><a href="https://docs.python.org/3.6/library/collections.html" target="_blank" rel="external">py3.6  collections — Container datatypes</a></li>
                  <li><a href="https://docs.python.org/2.7/library/collections.html" target="_blank" rel="external">py2.7  collections — High-performance container datatypes</a></li>
                  <li><a href="https://docs.python.org/2.7/library/userdict.html" target="_blank" rel="external">py2.7 UserDict UserList UserString</a></li>
                  <li><a href="https://en.wikipedia.org/wiki/Moving_average" target="_blank" rel="external">Moving average</a></li>
                  <li><a href="http://www.dongwm.com/archives/UserDict%E3%80%81UserString%E3%80%81UserList%E5%AD%98%E5%9C%A8%E7%9A%84%E6%84%8F%E4%B9%89/" target="_blank" rel="external">UserDict、UserString、UserList存在的意义</a></li>
                  <li><a href="http://stackoverflow.com/questions/25464647/list-vs-userlist-and-dict-vs-userdict" target="_blank" rel="external">list vs UserList and dict vs UserDict [stackoverflow]</a></li>
                </ul>
              </blockquote>
            </div>
            <script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://linw1995.com/2017/03/30/Python-collections/" data-id="cj3ehzgwu0007y8it26i4savp" class="article-share-link">Share</a>
            <div class="tags"><a href="/tags/Python/">Python</a></div>
            <div class="post-nav"><a href="/2017/03/31/可变与不可变/" class="pre">Python object的可变与不可变</a><a href="/2017/03/29/Python-functools/" class="next">Python functools</a></div>
            <div id="disqus_thread">
              <div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div>
              <script>
                var disqus_shortname = 'linw1995';
                var disqus_identifier = '2017/03/30/Python-collections/';
                var disqus_title = 'Python collections';
                var disqus_url = 'http://linw1995.com/2017/03/30/Python-collections/';
                $('.btn_click_load').click(function() {
                  (function() {
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript';
                    dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
                  $('.btn_click_load').css('display', 'none');
                });
                $.ajax({
                  url: 'https://disqus.com/favicon.ico',
                  timeout: 3000,
                  type: 'GET',
                  success: (function() {
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript';
                    dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    $('.btn_click_load').css('display', 'none');
                  })(),
                  error: function() {
                    $('.btn_click_load').css('display', 'block');
                  }
                });
              </script>
              <script id="dsq-count-scr" src="//linw1995.disqus.com/count.js" async></script>
            </div>
          </div>
        </div>
      </div>
      <div class="pure-u-1 pure-u-md-4-4">
        <div id="footer">Copyright © 2017 <a href="/." rel="nofollow">linw1995.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow"
            target="_blank" href="https://github.com/pagecho"> Cho.</a></div>
      </div>
    </div>
    <a id="rocket" href="#top" class="show"></a>
    <script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script>
    <script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script>
    <script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script>
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css">
    <script type="text/javascript" src="/js/search.js?v=0.0.0"></script>
    <script>
      var search_path = 'search.xml';
      if (search_path.length == 0) {
        search_path = 'search.xml';
      }
      var path = '/' + search_path;
      searchFunc(path, 'local-search-input', 'local-search-result');
    </script>
    <script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script>
    <script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script>
  </div>
</body>

</html>