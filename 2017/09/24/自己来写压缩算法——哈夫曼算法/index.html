<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="description" content="Personal Blog">
  <title>自己来写压缩算法——哈夫曼算法 | linw1995</title>
  <link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png">
  <link rel="alternate" type="application/atom+xml" href="/atom.xml">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-86170223-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

<body>
  <div class="body_container">
    <div id="header">
      <div class="site-name">
        <h1 class="hidden">自己来写压缩算法——哈夫曼算法</h1><a id="logo" href="/.">linw1995</a>
        <p class="description"></p>
      </div>
      <div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div>
    </div>
    <div id="layout" class="pure-g">
      <div class="pure-u-1 pure-u-md-4-4">
        <div class="content_container">
          <div class="post">
            <h1 class="post-title">自己来写压缩算法——哈夫曼算法</h1>
            <div class="post-meta">Sep 24, 2017<span> | </span><span class="category"><a href="/categories/Algorithms/">Algorithms</a></span>
              <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span>
            </div>
            <a data-disqus-identifier="2017/09/24/自己来写压缩算法——哈夫曼算法/" href="/2017/09/24/自己来写压缩算法——哈夫曼算法/#disqus_thread" class="disqus-comment-count"></a>
            <div class="clear">
              <div id="toc" class="toc-article">
                <div class="toc-title">Contents</div>
                <ol class="toc">
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#哈夫曼算法"><span class="toc-number">1.</span> <span class="toc-text">
  哈夫曼算法</span></a>
                    <ol class="toc-child">
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#哈夫曼树"><span class="toc-number">1.1.</span> <span class="toc-text">
  哈夫曼树</span></a></li>
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#哈夫曼编码"><span class="toc-number">1.2.</span> <span class="toc-text">
  哈夫曼编码</span></a></li>
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#哈夫曼编码MIT-LICENCE文件结果"><span class="toc-number">1.3.</span> <span class="toc-text">
  哈夫曼编码MIT-LICENCE文件结果</span></a></li>
                    </ol>
                  </li>
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#压缩实现"><span class="toc-number">2.</span> <span class="toc-text">
  压缩实现</span></a>
                    <ol class="toc-child">
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#压缩"><span class="toc-number">2.1.</span> <span class="toc-text">
  压缩</span></a></li>
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#解压"><span class="toc-number">2.2.</span> <span class="toc-text">
  解压</span></a></li>
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#尾部处理"><span class="toc-number">2.3.</span> <span class="toc-text">
  尾部处理</span></a></li>
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#存储字节统计结果"><span class="toc-number">2.4.</span> <span class="toc-text">
  存储字节统计结果</span></a></li>
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#测试"><span class="toc-number">2.5.</span> <span class="toc-text">
  测试</span></a></li>
                      <li class="toc-item toc-level-3"><a class="toc-link" href="#代码"><span class="toc-number">2.6.</span> <span class="toc-text">
  代码</span></a></li>
                    </ol>
                  </li>
                </ol>
              </div>
            </div>
            <div class="post-content">
              <p>一般文件的编码都是等长的，一些常用字符的编码与很少用到的等长，可若是编码是变长的呢？无疑可以使整个文件大小减小。为了解码时不遇到任何歧义的问题，则<strong>每个有效字符所代表的变长编码不能是其它字符的前缀</strong>，这种编码也叫做<strong>前缀编码</strong>。而如何做到这一点呢，接下的内容会尽可能地讲明白。</p>
              <h2 id="哈夫曼算法">
                <a href="#哈夫曼算法" class="headerlink" title="哈夫曼算法"></a>哈夫曼算法</h2>
              <p>若是把等长的编码(一字节)用平衡二叉树来表示，字符共有256个，那么树的深度就有 $\log_{2}{256}=8$ 。</p>
              <p>如果变作变长编码，那么所有有儿子（child）的节点（node）都不能用来表示，唯有子叶（leaf，没有儿子的节点）才可以用来表示。这是因为<strong>每个有效字符所代表的变长编码不能是其它字符的前缀</strong>。而且树结构也不可能是平衡二叉树了，树的深度肯定会大于8。</p>
              <p>例如，有一份<a href="/2017/09/24/自己来写压缩算法——哈夫曼算法/MIT.txt" title="MIT-LICENCE">MIT-LICENCE</a>文件，其中空格<code>&#39;</code>&nbsp;<code>&#39;</code>有163个，而字母<code>&#39;</code>v<code>&#39;</code>却只有一个。那么让<code>&#39;</code>&nbsp;<code>&#39;</code>表示为<code>110</code>,<code>&#39;</code>v<code>&#39;</code>表示为<code>0111011101</code>，那么得省$(8
                - 3) \times 163 - (8 - 10) \times 1 = 817$个bit。可见变长编码确确实实能起到压缩的作用。</p>
              <h3 id="哈夫曼树">
                <a href="#哈夫曼树" class="headerlink" title="哈夫曼树"></a>哈夫曼树</h3>
              <p><strong>哈夫曼树Huffman Tree</strong>，也叫做<strong>最优二叉树</strong>，是一种带权路径长度最短的二叉树。所谓树的带权路径长度，就是树中所有的叶结点的权值乘上其到根结点的路径长度（若根结点为$0$层，叶结点到根结点的路径长度为叶结点的层数）。树的路径长度是从树根到每一结点的路径长度之和，记为$\operatorname{WPL}=(W_1 \times L_<br>1+W_2 \times L_2+W_3 \times L_3+…+W_n
                \times L_n)$，$N$个权值$W_i(i=1,2,…n)$构成一棵有$N$个叶结点的二叉树，相应的叶结点的路径长度为$L_i(i=1,2,…n)$。可以证明霍夫曼树的$\operatorname{WPL}$是最小的。</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">      /-40                /-40                /-40</div><div class="line">   /-|                 /-|                 /-|</div><div class="line">  |   \-48            |   \-48            |  |   /-48</div><div class="line">--|                   |                   |   \-|</div><div class="line">  |   /-60          --|      /-60       --|      \-18</div><div class="line">   \-|                |   /-|             |</div><div class="line">     |   /-30         |  |   \-20         |      /-60</div><div class="line">      \-|              \-|                |   /-|</div><div class="line">        |   /-18         |   /-30          \-|   \-20</div><div class="line">         \-|              \-|                |</div><div class="line">            \-20             \-18             \-30</div><div class="line"></div><div class="line">      (0)                (1)                  (2)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>计算上面三颗树的$\operatorname{WPL}$：<br>(0): $ 18 \times 3 + 20 \times 3 + 30 \times 2 + 60 \times 1 + 48 \times 1 + 40 \times 1 = 286$<br>(1): $ 18 \times 2 + 30 \times 2 + 20 \times 2 + 60 \times 2 + 48 \times 1 + 40 \times 1 = 344$<br>(2): $
                20 \times 2 + 60 \times 2 + 18 \times 2 + 48 \times 2 + 30 \times 1 + 40 \times 1 = 362$</p>
              <p>可以看出同样的子叶，构造出来的树(0)的$\operatorname{WPL}$最小。<br>其实它就是哈夫曼树，可以验证同样的子叶,构造出来树的$\operatorname{WPL}$没有比这更小的了(可以同$\operatorname{WPL}$不同构)。</p>
              <p><strong>结论</strong>: 权值越大的子叶离根节点越近，即路径长度越短；反之，权值越小的子叶离根节点越远，即路径长度越长。</p>
              <p>构造哈夫曼树的算法步骤下：</p>
              <ol>
                <li>将所有的要添加到哈夫曼树的子叶按从小达到排列</li>
                <li>找出两个权值最小的节点，拼接成一树结构，父节点的权值为二者之和</li>
                <li>父节点为新的节点，加入排列中，重复步骤2</li>
              </ol>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">1          /-1                                             /-3</div><div class="line">        3 |                                             /-|</div><div class="line">2          \-2          /-3             /-3            |  |   /-1</div><div class="line">                     6 |   /-1       6 |   /-1         |   \-|</div><div class="line">3       3               \-|             \-|          --|      \-2</div><div class="line">                           \-2             \-2         |</div><div class="line">4       4            4                  /-4            |   /-4</div><div class="line">                                     9 |                \-|</div><div class="line">5       5            5                  \-5                \-5</div><div class="line"></div><div class="line">(0)      (1)           (2)             (3)               (4)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="哈夫曼编码">
                <a href="#哈夫曼编码" class="headerlink" title="哈夫曼编码"></a>哈夫曼编码</h3>
              <p>从根结点开始，左子树为<code>&#39;0&#39;</code>,右子树为<code>&#39;1&#39;</code>，累积到子叶得到的编码就是哈夫曼编码。</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">| leaf | code |</div><div class="line">|------|------|</div><div class="line">| 1    | 010  |</div><div class="line">| 2    | 011  |</div><div class="line">| 3    | 00   |</div><div class="line">| 4    | 10   |</div><div class="line">| 5    | 11   |</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="哈夫曼编码MIT-LICENCE文件结果">
                <a href="#哈夫曼编码MIT-LICENCE文件结果" class="headerlink" title="哈夫曼编码MIT-LICENCE文件结果"></a>哈夫曼编码MIT-LICENCE文件结果</h3>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">| byte | count | code       |     | byte | count | code       |     | byte | count | code       |</div><div class="line">|------|-------|------------|     |------|-------|------------|     |------|-------|------------|</div><div class="line">| &apos;/&apos;  | 1     | 0111011010 |     | &apos;j&apos;  | 1     | 0111011011 |     | &apos;:&apos;  | 1     | 0111011100 |</div><div class="line">| &apos;v&apos;  | 1     | 0111011101 |     | &apos;K&apos;  | 1     | 0111011110 |     | &apos;X&apos;  | 1     | 0111011111 |</div><div class="line">| &apos;(&apos;  | 2     | 011101000  |     | &apos;)&apos;  | 2     | 011101001  |     | &apos;&lt;&apos;  | 2     | 011101010  |</div><div class="line">| &apos;&gt;&apos;  | 2     | 011101011  |     | &apos;V&apos;  | 2     | 011101100  |     | &apos;.&apos;  | 3     | 01101100   |</div><div class="line">| &apos;&quot;&apos;  | 4     | 01101101   |     | &apos;B&apos;  | 5     | 11110100   |     | &apos;Y&apos;  | 6     | 11110101   |</div><div class="line">| &apos;G&apos;  | 6     | 0011110    |     | &apos;\r&apos; | 7     | 0011111    |     | &apos;\n&apos; | 7     | 0100110    |</div><div class="line">| &apos;M&apos;  | 7     | 0100111    |     | &apos;P&apos;  | 8     | 0110111    |     | &apos;m&apos;  | 8     | 0111000    |</div><div class="line">| &apos;U&apos;  | 8     | 0111001    |     | &apos;y&apos;  | 9     | 1011000    |     | &apos;b&apos;  | 9     | 1011001    |</div><div class="line">| &apos;W&apos;  | 9     | 1011010    |     | &apos;g&apos;  | 10    | 1011011    |     | &apos;w&apos;  | 10    | 1110000    |</div><div class="line">| &apos;D&apos;  | 10    | 1110001    |     | &apos;C&apos;  | 12    | 1111011    |     | &apos;u&apos;  | 12    | 000100     |</div><div class="line">| &apos;F&apos;  | 12    | 000101     |     | &apos;p&apos;  | 13    | 001110     |     | &apos;L&apos;  | 14    | 010010     |</div><div class="line">| &apos;f&apos;  | 15    | 011010     |     | &apos;c&apos;  | 17    | 100010     |     | &apos;l&apos;  | 17    | 100011     |</div><div class="line">| &apos;d&apos;  | 17    | 101000     |     | &apos;H&apos;  | 18    | 101001     |     | &apos;,&apos;  | 22    | 111001     |</div><div class="line">| &apos;h&apos;  | 23    | 111100     |     | &apos;S&apos;  | 25    | 00011      |     | &apos;a&apos;  | 26    | 00110      |</div><div class="line">| &apos;A&apos;  | 28    | 01000      |     | &apos;r&apos;  | 29    | 01010      |     | &apos;n&apos;  | 30    | 01011      |</div><div class="line">| &apos;N&apos;  | 30    | 01100      |     | &apos;s&apos;  | 34    | 01111      |     | &apos;R&apos;  | 34    | 10000      |</div><div class="line">| &apos;E&apos;  | 35    | 10010      |     | &apos;I&apos;  | 35    | 10011      |     | &apos;O&apos;  | 36    | 10101      |</div><div class="line">| &apos;T&apos;  | 39    | 10111      |     | &apos;i&apos;  | 45    | 11101      |     | &apos;e&apos;  | 48    | 11111      |</div><div class="line">| &apos;t&apos;  | 49    | 0000       |     | &apos;o&apos;  | 52    | 0010       |     | &apos; &apos;  | 163   | 110        |</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">                     /----&apos;t&apos; 49 0000</div><div class="line">                    |</div><div class="line">               /----0            /----&apos;u&apos; 12 000100</div><div class="line">              |     |      /----0</div><div class="line">              |      \----1      \----&apos;F&apos; 12 000101</div><div class="line">         /----0           |</div><div class="line">        |     |            \----&apos;S&apos; 25 00011</div><div class="line">        |     |</div><div class="line">        |     |      /----&apos;o&apos; 52 0010</div><div class="line">        |      \----1</div><div class="line">        |           |      /----&apos;a&apos; 26 00110</div><div class="line">        |            \----1</div><div class="line">        |                 |      /----&apos;p&apos; 13 001110</div><div class="line">        |                  \----1</div><div class="line">        |                       |      /----&apos;G&apos; 6 0011110</div><div class="line">        |                        \----1</div><div class="line">        |                              \----&apos;\r&apos; 7 0011111</div><div class="line">        |</div><div class="line">        |                  /----&apos;A&apos; 28 01000</div><div class="line">   /----0            /----0</div><div class="line">  |     |           |     |      /----&apos;L&apos; 14 010010</div><div class="line">  |     |           |      \----1</div><div class="line">  |     |           |           |      /----&apos;\n&apos; 7 0100110</div><div class="line">  |     |      /----0            \----1</div><div class="line">  |     |     |     |                  \----&apos;M&apos; 7 0100111</div><div class="line">  |     |     |     |</div><div class="line">  |     |     |     |      /----&apos;r&apos; 29 01010</div><div class="line">  |     |     |      \----1</div><div class="line">  |     |     |            \----&apos;n&apos; 30 01011</div><div class="line">  |     |     |</div><div class="line">  |     |     |            /----&apos;N&apos; 30 01100</div><div class="line">  |     |     |           |</div><div class="line">  |     |     |      /----0      /----&apos;f&apos; 15 011010</div><div class="line">  |      \----1     |     |     |</div><div class="line">  |           |     |      \----1            /----&apos;.&apos; 3 01101100</div><div class="line">  |           |     |           |      /----0</div><div class="line">  |           |     |            \----1      \----&apos;&quot;&apos; 4 01101101</div><div class="line">  |           |     |                 |</div><div class="line">  |           |     |                  \----&apos;P&apos; 8 0110111</div><div class="line">  |           |     |</div><div class="line">  |           |     |                  /----&apos;m&apos; 8 0111000</div><div class="line">  |           |     |            /----0</div><div class="line">  |           |     |           |      \----&apos;U&apos; 8 0111001</div><div class="line">  |           |     |           |</div><div class="line">  |            \----1           |                  /----&apos;(&apos; 2 011101000</div><div class="line">  |                 |           |            /----0</div><div class="line">  |                 |      /----0           |      \----&apos;)&apos; 2 011101001</div><div class="line">  |                 |     |     |      /----0</div><div class="line">  |                 |     |     |     |     |      /----&apos;&lt;&apos; 2 011101010</div><div class="line">  |                 |     |     |     |      \----1</div><div class="line">  |                 |     |     |     |            \----&apos;&gt;&apos; 2 011101011</div><div class="line">  |                 |     |     |     |</div><div class="line">  |                 |     |      \----1            /----&apos;V&apos; 2 011101100</div><div class="line">--|                 |     |           |      /----0</div><div class="line">  |                 |     |           |     |     |      /----&apos;/&apos; 1 0111011010</div><div class="line">  |                 |     |           |     |      \----1</div><div class="line">  |                  \----1           |     |            \----&apos;j&apos; 1 0111011011</div><div class="line">  |                       |            \----1</div><div class="line">  |                       |                 |            /----&apos;:&apos; 1 0111011100</div><div class="line">  |                       |                 |      /----0</div><div class="line">  |                       |                 |     |      \----&apos;v&apos; 1 0111011101</div><div class="line">  |                       |                  \----1</div><div class="line">  |                       |                       |      /----&apos;K&apos; 1 0111011110</div><div class="line">  |                       |                        \----1</div><div class="line">  |                       |                              \----&apos;X&apos; 1 0111011111</div><div class="line">  |                       |</div><div class="line">  |                        \----&apos;s&apos; 34 01111</div><div class="line">  |</div><div class="line">  |                        /----&apos;R&apos; 34 10000</div><div class="line">  |                  /----0</div><div class="line">  |                 |     |      /----&apos;c&apos; 17 100010</div><div class="line">  |                 |      \----1</div><div class="line">  |            /----0            \----&apos;l&apos; 17 100011</div><div class="line">  |           |     |</div><div class="line">  |           |     |      /----&apos;E&apos; 35 10010</div><div class="line">  |           |      \----1</div><div class="line">  |           |            \----&apos;I&apos; 35 10011</div><div class="line">  |           |</div><div class="line">  |      /----0                  /----&apos;d&apos; 17 101000</div><div class="line">  |     |     |            /----0</div><div class="line">  |     |     |      /----0      \----&apos;H&apos; 18 101001</div><div class="line">  |     |     |     |     |</div><div class="line">  |     |     |     |      \----&apos;O&apos; 36 10101</div><div class="line">  |     |     |     |</div><div class="line">  |     |      \----1                  /----&apos;y&apos; 9 1011000</div><div class="line">  |     |           |            /----0</div><div class="line">  |     |           |           |      \----&apos;b&apos; 9 1011001</div><div class="line">  |     |           |      /----0</div><div class="line">   \----1           |     |     |      /----&apos;W&apos; 9 1011010</div><div class="line">        |            \----1      \----1</div><div class="line">        |                 |            \----&apos;g&apos; 10 1011011</div><div class="line">        |                 |</div><div class="line">        |                  \----&apos;T&apos; 39 10111</div><div class="line">        |</div><div class="line">        |      /----&apos; &apos; 163 110</div><div class="line">        |     |</div><div class="line">        |     |                        /----&apos;w&apos; 10 1110000</div><div class="line">        |     |                  /----0</div><div class="line">        |     |            /----0      \----&apos;D&apos; 10 1110001</div><div class="line">         \----1           |     |</div><div class="line">              |      /----0      \----&apos;,&apos; 22 111001</div><div class="line">              |     |     |</div><div class="line">              |     |      \----&apos;i&apos; 45 11101</div><div class="line">              |     |</div><div class="line">               \----1            /----&apos;h&apos; 23 111100</div><div class="line">                    |           |</div><div class="line">                    |      /----0            /----&apos;B&apos; 5 11110100</div><div class="line">                    |     |     |      /----0</div><div class="line">                    |     |      \----1      \----&apos;Y&apos; 6 11110101</div><div class="line">                     \----1           |</div><div class="line">                          |            \----&apos;C&apos; 12 1111011</div><div class="line">                          |</div><div class="line">                           \----&apos;e&apos; 48 11111</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h2 id="压缩实现">
                <a href="#压缩实现" class="headerlink" title="压缩实现"></a>压缩实现</h2>
              <p>知道了如何编码，那怎么应用到压缩上去呢？</p>
              <h3 id="压缩">
                <a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3>
              <ol>
                <li>把文件分割成一个个字节，统计各个字节（总共256个）的数量</li>
                <li>根据统计出来的权重，来构造哈夫曼树，得出哈夫曼编码</li>
                <li>一字节一字节的转换为哈夫曼编码，再保存到新的文件（压缩文件）里</li>
                <li>再把统计的结果，也存储到文件里，用来解压缩</li>
              </ol>
              <p><strong>注意</strong>：转换后数据不一定能被8整除，那么保存的结尾就要稍作处理</p>
              <p>原文：</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">b&apos;Copyr……</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>转换：</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">| b&apos;C&apos;    | b&apos;o&apos; | b&apos;p&apos;   | b&apos;y&apos;    | b&apos;r&apos;  | ... |</div><div class="line">|---------|------|--------|---------|-------|-----|</div><div class="line">| 1111011 | 0010 | 001110 | 1011000 | 01010 | ... |</div><div class="line"></div><div class="line">11110110010001110101100001010……</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>分割成字节：</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">| 1111 0110 | 0100 0111 | 0101 1000 | 0101 0…… |</div><div class="line">|-----------|-----------|-----------|----------|</div><div class="line">| 246       | 71        | 88        | ……       |</div><div class="line">| b&apos;\xf6&apos;   | b&apos;G&apos;      | b&apos;X&apos;      | ……       |</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>压缩结果：</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">b&apos;\xf6GX……</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>这么短短的一段，从5字节压缩成3.6+字节大小</p>
              <h3 id="解压">
                <a href="#解压" class="headerlink" title="解压"></a>解压</h3>
              <ol>
                <li>读取压缩文件中的统计结果，构造哈夫曼树</li>
                <li>一比特一比特的用哈夫曼树索引，得到原本的字节，再保存到新文件中</li>
              </ol>
              <p>压缩文件字节流：</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">b&apos;\xf6GX……</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>得到比特流：</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">| b&apos;\xf6&apos;   | b&apos;G&apos;      | b&apos;X&apos;      | ……       |</div><div class="line">|-----------|-----------|-----------|----------|</div><div class="line">| 246       | 71        | 88        | ……       |</div><div class="line">| 1111 0110 | 0100 0111 | 0101 1000 | 0101 0…… |</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>根据哈夫曼树，索引出对应的值，<code>&#39;0&#39;</code>进入左子树，<code>&#39;1&#39;</code>进入右子树，直到子叶……</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">11110110010001110101100001010……</div><div class="line"></div><div class="line">| 1111011 | 0010 | 001110 | 1011000 | 01010 | ... |</div><div class="line">|---------|------|--------|---------|-------|-----|</div><div class="line">| b&apos;C&apos;    | b&apos;o&apos; | b&apos;p&apos;   | b&apos;y&apos;    | b&apos;r&apos;  | ... |</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <p>原文：</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">b&apos;Copyr……</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="尾部处理">
                <a href="#尾部处理" class="headerlink" title="尾部处理"></a>尾部处理</h3>
              <p>若结尾出现以下情况</p>
              <ol>
                <li>
                  <p>结尾长度小于一字节</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre> </td>
                        <td class="code">
                          <pre><div class="line">    压缩           解压</div><div class="line"></div><div class="line">| 0010    |   | b&apos;\x02&apos;  |</div><div class="line">|---------|   |----------|</div><div class="line">| 2       |   | 2        |</div><div class="line">| b&apos;\x02&apos; |   | 00000010 |</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>结尾长度等于一字节</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre> </td>
                        <td class="code">
                          <pre><div class="line">    压缩           解压</div><div class="line"></div><div class="line">| 00000010 |  | b&apos;\x02&apos;  |</div><div class="line">|----------|  |----------|</div><div class="line">| 2        |  | 2        |</div><div class="line">| b&apos;\x02&apos;  |  | 00000010 |</div></pre> </td>
                      </tr>
                    </table>
                  </figure>
                </li>
              </ol>
              <p>为了避免尾部可能出现的错误，所以将对尾部进行处理：<strong>在尾部写入之前，写入尾部的长度数据</strong></p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">      压缩               解压</div><div class="line"></div><div class="line">| 0010        |   | b&apos;\x04\x02&apos;  |</div><div class="line">|-------------|   |--------------|</div><div class="line">| 2           |   | 2            |</div><div class="line">| b&apos;\x04\x02&apos; |   | 0010         |</div><div class="line"></div><div class="line">      压缩               解压</div><div class="line"></div><div class="line">| 00000010    |   | b&apos;\x08\x02&apos;  |</div><div class="line">|-------------|   |--------------|</div><div class="line">| 2           |   | 2            |</div><div class="line">| b&apos;\x08\x02&apos; |   | 00000010     |</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="存储字节统计结果">
                <a href="#存储字节统计结果" class="headerlink" title="存储字节统计结果"></a>存储字节统计结果</h3>
              <p>字符（一字节）字节，字符以一字节来存，最多有256个字符。<br>还要存储出现次数的字节长度，用来读取。</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">| for                  | value         | bytes               |</div><div class="line">|----------------------|---------------|---------------------|</div><div class="line">| charNum              | 256 - 1 (max) | b&apos;\xff&apos;             |</div><div class="line">| Count&apos;s bytes length | 4             | b&apos;\x04              |</div><div class="line">| char                 | 0             | b&apos;\x00&apos;             |</div><div class="line">| char Count           | 255           | b&apos;\x00\x00\x00\xff&apos; |</div><div class="line">| char                 | 1             | b&apos;\x01&apos;             |</div><div class="line">| ...                  | ...           | ...                 |</div><div class="line"></div><div class="line">b&apos;\xff\x04\x00\x00\x00\x00\xff\x01...</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="测试">
                <a href="#测试" class="headerlink" title="测试"></a>测试</h3>
              <p>拿<a href="/2017/09/24/自己来写压缩算法——哈夫曼算法/MIT.txt" title="MIT-LICENCE">MIT-LICENCE</a>文件来测试：</p>
              <figure class="highlight plain">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre> </td>
                    <td class="code">
                      <pre><div class="line">| before      | after     |</div><div class="line">|-------------|-----------|</div><div class="line">| 1,072 bytes | 859 bytes |</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <h3 id="代码">
                <a href="#代码" class="headerlink" title="代码"></a>代码</h3>
              <script src="https://gist.github.com/linw1995/7e49f6d05276538d8675874c585ece5d.js"></script>
              <p>GIST: <a href="https://gist.github.com/linw1995/7e49f6d05276538d8675874c585ece5d" target="_blank" rel="external">Huffman Encoding and Data Compression | linw1995</a></p>
            </div>
            <script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://linw1995.com/2017/09/24/自己来写压缩算法——哈夫曼算法/" data-id="cj7t6ev4e001yycitv6s8manv" class="article-share-link">Share</a>
            <div class="tags"><a href="/tags/Python/">Python</a></div>
            <div class="post-nav"><a href="/2017/08/07/Windows上程序员神器——Cmder/" class="next">Windows上程序员神器——Cmder</a></div>
            <div id="disqus_thread">
              <div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div>
              <script>
                var disqus_shortname = 'linw1995';
                var disqus_identifier = '2017/09/24/自己来写压缩算法——哈夫曼算法/';
                var disqus_title = '自己来写压缩算法——哈夫曼算法';
                var disqus_url = 'http://linw1995.com/2017/09/24/自己来写压缩算法——哈夫曼算法/';
                $('.btn_click_load').click(function() {
                  (function() {
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript';
                    dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
                  $('.btn_click_load').css('display', 'none');
                });
                $.ajax({
                  url: 'https://disqus.com/favicon.ico',
                  timeout: 3000,
                  type: 'GET',
                  success: (function() {
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript';
                    dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    $('.btn_click_load').css('display', 'none');
                  })(),
                  error: function() {
                    $('.btn_click_load').css('display', 'block');
                  }
                });
              </script>
              <script id="dsq-count-scr" src="//linw1995.disqus.com/count.js" async></script>
            </div>
          </div>
        </div>
      </div>
      <div class="pure-u-1 pure-u-md-4-4">
        <div id="footer">Copyright © 2017 <a href="/." rel="nofollow">linw1995.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow"
            target="_blank" href="https://github.com/pagecho"> Cho.</a></div>
      </div>
    </div>
    <a id="rocket" href="#top" class="show"></a>
    <script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script>
    <script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script>
    <script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script>
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css">
    <script type="text/javascript" src="/js/search.js?v=0.0.0"></script>
    <script>
      var search_path = 'search.xml';
      if (search_path.length == 0) {
        search_path = 'search.xml';
      }
      var path = '/' + search_path;
      searchFunc(path, 'local-search-input', 'local-search-result');
    </script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({ showMathMenu: false, jax: ["input/TeX","output/CommonHTML"], tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} }); </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"
      async></script>
    <script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script>
    <script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script>
  </div>
</body>

</html>