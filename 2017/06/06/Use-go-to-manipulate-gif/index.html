<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="description" content="Personal Blog">
  <title>Use go to manipulate gif | linw1995</title>
  <link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css">
  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png">
  <link rel="alternate" type="application/atom+xml" href="/atom.xml">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-86170223-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

<body>
  <div class="body_container">
    <div id="header">
      <div class="site-name">
        <h1 class="hidden">Use go to manipulate gif</h1><a id="logo" href="/.">linw1995</a>
        <p class="description"></p>
      </div>
      <div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div>
    </div>
    <div id="layout" class="pure-g">
      <div class="pure-u-1 pure-u-md-4-4">
        <div class="content_container">
          <div class="post">
            <h1 class="post-title">Use go to manipulate gif</h1>
            <div class="post-meta">Jun 6, 2017<span> | </span><span class="category"><a href="/categories/Go/">Go</a></span>
              <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span>
            </div>
            <a data-disqus-identifier="2017/06/06/Use-go-to-manipulate-gif/" href="/2017/06/06/Use-go-to-manipulate-gif/#disqus_thread" class="disqus-comment-count"></a>
            <div class="clear">
              <div id="toc" class="toc-article">
                <div class="toc-title">Contents</div>
                <ol class="toc">
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#简单介绍下image-gif包"><span class="toc-number">1.</span> <span class="toc-text">
  简单介绍下image/gif包</span></a></li>
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#实例"><span class="toc-number">2.</span> <span class="toc-text">
  实例</span></a></li>
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#多张图片合成GIF"><span class="toc-number">3.</span> <span class="toc-text">
  多张图片合成GIF</span></a></li>
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#GIF拆分成一张张图片"><span class="toc-number">4.</span> <span class="toc-text">
  GIF拆分成一张张图片</span></a></li>
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#代码解析"><span class="toc-number">5.</span> <span class="toc-text">
  代码解析</span></a></li>
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#Gallery"><span class="toc-number">6.</span> <span class="toc-text">
  Gallery</span></a></li>
                  <li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">7.</span> <span class="toc-text">
  参考</span></a></li>
                </ol>
              </div>
            </div>
            <div class="post-content">
              <h2 id="简单介绍下image-gif包">
                <a href="#简单介绍下image-gif包" class="headerlink" title="简单介绍下image/gif包"></a>简单介绍下image/gif包</h2>
              <figure class="highlight go">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="keyword">type</span> GIF <span class="keyword">struct</span> &#123;</div><div class="line">        Image           []*image.Paletted <span class="comment">// 一组连续的图片</span></div><div class="line">        Delay           []<span class="keyword">int</span> <span class="comment">// 每张图片间的时间间隔，100为一秒</span></div><div class="line">        LoopCount       <span class="keyword">int</span> <span class="comment">// 循环次数</span></div><div class="line">        <span class="comment">// 每次切换图片所使用的处理方式，例如清空画布、去除背景、层叠</span></div><div class="line">        Disposal        []<span class="keyword">byte</span></div><div class="line">        <span class="comment">// 图片设置 存放图片高度、宽度等信息</span></div><div class="line">        Config          image.Config</div><div class="line">        <span class="comment">// 背景默认颜色在palette中的位置， 当使用DisposalBackground处理方式时使用。</span></div><div class="line">        BackgroundIndex <span class="keyword">byte</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> (</div><div class="line">        DisposalNone       = <span class="number">0x01</span></div><div class="line">        DisposalBackground = <span class="number">0x02</span></div><div class="line">        DisposalPrevious   = <span class="number">0x03</span></div><div class="line">)</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <ul>
                <li><code>func DecodeAll(r io.Reader) (*GIF, error)</code> DecodeAll从r中读取一个GIF图像，然后返回一个GIF对象</li>
                <li><code>func DecodeConfig(r io.Reader) (image.Config, error)</code> DecodeConfig从r中读取出GIF图像的全局颜色模型和尺寸，无需解码整个图像</li>
                <li><code>func EncodeAll(w io.Writer, g *GIF) error</code> EncodeAll把GIF图像写入w中</li>
              </ul>
              <h2 id="实例">
                <a href="#实例" class="headerlink" title="实例"></a>实例</h2><img src="/2017/06/06/Use-go-to-manipulate-gif/rgb.gif" alt="rgb" title="rgb">
              <figure class="highlight go">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">        <span class="string">"image"</span></div><div class="line">        <span class="string">"image/color"</span></div><div class="line">        <span class="string">"image/color/palette"</span></div><div class="line">        <span class="string">"image/gif"</span></div><div class="line">        <span class="string">"math"</span></div><div class="line">        <span class="string">"os"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</div><div class="line">        X, Y, R <span class="keyword">float64</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Circle)</span> <span class="title">Brightness</span><span class="params">(x, y <span class="keyword">float64</span>)</span> <span class="title">uint8</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> dx, dy <span class="keyword">float64</span> = c.X - x, c.Y - y</div><div class="line">        d := math.Sqrt(dx*dx+dy*dy) / c.R</div><div class="line">        <span class="keyword">if</span> d &gt; <span class="number">1</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">255</span></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">const</span> (</div><div class="line">                w, h   <span class="keyword">int</span>     = <span class="number">256</span>, <span class="number">256</span></div><div class="line">                R      <span class="keyword">float64</span> = <span class="number">50</span></div><div class="line">                <span class="comment">// 大约一秒30帧</span></div><div class="line">                frameN <span class="keyword">int</span>     = <span class="number">30</span></div><div class="line">                delay  <span class="keyword">int</span>     = <span class="number">100</span> / frameN</div><div class="line">        )</div><div class="line">        <span class="comment">// 216色 + 透明</span></div><div class="line">        <span class="keyword">var</span> palette = <span class="built_in">append</span>(palette.WebSafe, color.Transparent)</div><div class="line">        <span class="keyword">var</span> images []*image.Paletted</div><div class="line">        <span class="keyword">var</span> delays []<span class="keyword">int</span></div><div class="line">        <span class="keyword">var</span> disposals []<span class="keyword">byte</span></div><div class="line"></div><div class="line">        <span class="keyword">var</span> hw, hh <span class="keyword">float64</span> = <span class="keyword">float64</span>(w / <span class="number">2</span>), <span class="keyword">float64</span>(h / <span class="number">2</span>)</div><div class="line">        circles := []*Circle&#123;&amp;Circle&#123;&#125;, &amp;Circle&#123;&#125;, &amp;Circle&#123;&#125;&#125;</div><div class="line">        <span class="keyword">for</span> step := <span class="number">0</span>; step &lt; frameN; step++ &#123;</div><div class="line">                img := image.NewPaletted(image.Rect(<span class="number">0</span>, <span class="number">0</span>, w, h), palette)</div><div class="line">                images = <span class="built_in">append</span>(images, img)</div><div class="line">                delays = <span class="built_in">append</span>(delays, delay)</div><div class="line">                disposals = <span class="built_in">append</span>(disposals, gif.DisposalPrevious)</div><div class="line"></div><div class="line">                θ := <span class="number">2.0</span> * math.Pi / <span class="keyword">float64</span>(frameN) * <span class="keyword">float64</span>(step)</div><div class="line">                <span class="keyword">for</span> i, circle := <span class="keyword">range</span> circles &#123;</div><div class="line">                        θ<span class="number">0</span> := <span class="number">2</span> * math.Pi / <span class="number">3</span> * <span class="keyword">float64</span>(i)</div><div class="line">                        circle.X = hw - <span class="number">30</span>*math.Sin(θ<span class="number">0</span>) - <span class="number">30</span>*math.Sin(θ<span class="number">0</span>+θ)</div><div class="line">                        circle.Y = hh - <span class="number">30</span>*math.Cos(θ<span class="number">0</span>) - <span class="number">30</span>*math.Cos(θ<span class="number">0</span>+θ)</div><div class="line">                        circle.R = R</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">for</span> x := <span class="number">0</span>; x &lt; w; x++ &#123;</div><div class="line">                        <span class="keyword">for</span> y := <span class="number">0</span>; y &lt; h; y++ &#123;</div><div class="line">                                cr := circles[<span class="number">0</span>].Brightness(<span class="keyword">float64</span>(x), <span class="keyword">float64</span>(y))</div><div class="line">                                cg := circles[<span class="number">1</span>].Brightness(<span class="keyword">float64</span>(x), <span class="keyword">float64</span>(y))</div><div class="line">                                cb := circles[<span class="number">2</span>].Brightness(<span class="keyword">float64</span>(x), <span class="keyword">float64</span>(y))</div><div class="line">                                <span class="keyword">if</span> cr|cg|cb &gt; <span class="number">0x00</span> &#123;</div><div class="line">                                        img.Set(x, y, color.RGBA&#123;cr, cg, cb, <span class="number">255</span>&#125;)</div><div class="line">                                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                                        img.Set(x, y, color.Transparent)</div><div class="line">                                &#125;</div><div class="line">                        &#125;</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 把GIF写入文件rgb.gif</span></div><div class="line">        f, err := os.Create(<span class="string">"rgb.gif"</span>)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="built_in">panic</span>(err)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">defer</span> f.Close()</div><div class="line">        gif.EncodeAll(f, &amp;gif.GIF&#123;</div><div class="line">                Image:    images,</div><div class="line">                Delay:    delays,</div><div class="line">                Disposal: disposals,</div><div class="line">        &#125;)</div><div class="line">&#125;</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <blockquote> <a href="https://gist.github.com/linw1995/820b05ac3fbab34937635d30a61740fb#file-rgb-go" target="_blank" rel="external">rgb.go | Gist</a> </blockquote>
              <h2 id="多张图片合成GIF">
                <a href="#多张图片合成GIF" class="headerlink" title="多张图片合成GIF"></a>多张图片合成GIF</h2>
              <p>若是我们要把多张图片(png, jpeg)转变成<strong>GIF</strong>, 该怎么做呢</p> <img src="/2017/06/06/Use-go-to-manipulate-gif/inputs.png" alt="Inputs" title="Inputs">
              <p>比如把以上图片做成动图</p> <img src="/2017/06/06/Use-go-to-manipulate-gif/scriptK.gif" alt="Output" title="Output">
              <figure class="highlight go">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">        <span class="string">"fmt"</span></div><div class="line">        <span class="string">"os"</span></div><div class="line">        <span class="string">"regexp"</span></div><div class="line"></div><div class="line">        <span class="string">"image"</span></div><div class="line">        <span class="string">"image/color"</span></div><div class="line">        <span class="string">"image/color/palette"</span></div><div class="line">        <span class="string">"image/draw"</span></div><div class="line">        <span class="string">"image/gif"</span></div><div class="line">        _ <span class="string">"image/png"</span></div><div class="line">        _ <span class="string">"image/jpeg"</span></div><div class="line">        <span class="string">"io/ioutil"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(os.Args) == <span class="number">1</span> &#123;</div><div class="line">                <span class="built_in">panic</span>(fmt.Errorf(<span class="string">"len(os.Args) less than 2"</span>))</div><div class="line">        &#125;</div><div class="line">        format := fmt.Sprintf(<span class="string">"%%0%dd"</span>, <span class="built_in">len</span>(<span class="keyword">string</span>(<span class="built_in">len</span>(os.Args)))+<span class="number">1</span>)</div><div class="line">        <span class="comment">// 216色 + 透明</span></div><div class="line">        palette := <span class="built_in">append</span>(palette.WebSafe, color.Transparent)</div><div class="line">        <span class="keyword">for</span> i, fnFmt := <span class="keyword">range</span> os.Args[<span class="number">1</span>:] &#123;</div><div class="line">                pattern, err := regexp.Compile(fnFmt)</div><div class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                        <span class="built_in">panic</span>(err)</div><div class="line">                &#125;</div><div class="line">                files, _ := ioutil.ReadDir(<span class="string">"./"</span>)</div><div class="line">                outGif := &amp;gif.GIF&#123;&#125;</div><div class="line">                <span class="keyword">for</span> _, file := <span class="keyword">range</span> files &#123;</div><div class="line">                        <span class="keyword">if</span> pattern.MatchString(file.Name()) &#123;</div><div class="line">                                fmt.Print(<span class="string">"\r"</span>, file.Name())</div><div class="line">                                f, err := os.Open(file.Name())</div><div class="line">                                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                                        <span class="built_in">panic</span>(err)</div><div class="line">                                &#125;</div><div class="line">                                <span class="keyword">defer</span> f.Close()</div><div class="line"></div><div class="line">                                img, _, err := image.Decode(f)</div><div class="line">                                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                                        <span class="built_in">panic</span>(err)</div><div class="line">                                &#125;</div><div class="line">                                <span class="comment">// 图片格式转换</span></div><div class="line">                                bounds := img.Bounds()</div><div class="line">                                palettedImage := image.NewPaletted(bounds, palette)</div><div class="line">                                draw.Draw(palettedImage, bounds, img, image.ZP, draw.Src)</div><div class="line"></div><div class="line">                                outGif.Image = <span class="built_in">append</span>(outGif.Image, palettedImage)</div><div class="line">                                outGif.Delay = <span class="built_in">append</span>(outGif.Delay, <span class="number">1</span>)</div><div class="line">                                <span class="comment">// outGif.Disposal = append(outGif.Disposal, gif.DisposalPrevious)</span></div><div class="line">                        &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// 把GIF写入文件rgb.gif</span></div><div class="line">                f, err := os.Create(fmt.Sprintf(format, i) + <span class="string">".gif"</span>)</div><div class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                        <span class="built_in">panic</span>(err)</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">defer</span> f.Close()</div><div class="line">                gif.EncodeAll(f, outGif)</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <blockquote> <a href="https://gist.github.com/linw1995/820b05ac3fbab34937635d30a61740fb#file-img2gif-go" target="_blank" rel="external">img2gif.go | Gist</a> </blockquote>
              <h2 id="GIF拆分成一张张图片">
                <a href="#GIF拆分成一张张图片" class="headerlink" title="GIF拆分成一张张图片"></a>GIF拆分成一张张图片</h2>
              <figure class="highlight go">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre> </td>
                    <td class="code">
                      <pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">        <span class="string">"fmt"</span></div><div class="line">        <span class="string">"image"</span></div><div class="line">        <span class="string">"image/draw"</span></div><div class="line">        <span class="string">"image/gif"</span></div><div class="line">        <span class="string">"image/png"</span></div><div class="line">        <span class="string">"os"</span></div><div class="line">        <span class="string">"strings"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(os.Args) == <span class="number">1</span> &#123;</div><div class="line">                <span class="built_in">panic</span>(fmt.Errorf(<span class="string">"len(os.Args) less than 2"</span>))</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> _, fn := <span class="keyword">range</span> os.Args[<span class="number">1</span>:] &#123;</div><div class="line">                f, err := os.Open(fn)</div><div class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                        <span class="built_in">panic</span>(err)</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">defer</span> f.Close()</div><div class="line"></div><div class="line">                inGif, err := gif.DecodeAll(f)</div><div class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                        <span class="built_in">panic</span>(err)</div><div class="line">                &#125;</div><div class="line">                config, _ := gif.DecodeConfig(f)</div><div class="line">                \\ 获取GIF的高宽</div><div class="line">                rect := image.Rect(<span class="number">0</span>, <span class="number">0</span>, config.Width, config.Height)</div><div class="line">                <span class="keyword">if</span> rect.Min == rect.Max &#123;</div><div class="line">                        <span class="keyword">var</span> max image.Point</div><div class="line">                        <span class="keyword">for</span> _, frame := <span class="keyword">range</span> inGif.Image &#123;</div><div class="line">                                maxF := frame.Bounds().Max</div><div class="line">                                <span class="keyword">if</span> max.X &lt; maxF.X &#123;</div><div class="line">                                        max.X = maxF.X</div><div class="line">                                &#125;</div><div class="line">                                <span class="keyword">if</span> max.Y &lt; maxF.Y &#123;</div><div class="line">                                        max.Y = maxF.Y</div><div class="line">                                &#125;</div><div class="line">                        &#125;</div><div class="line">                        rect.Max = max</div><div class="line">                &#125;</div><div class="line">                format := fmt.Sprintf(<span class="string">"%%0%dd"</span>, <span class="built_in">len</span>(<span class="keyword">string</span>(<span class="built_in">len</span>(inGif.Image)))+<span class="number">1</span>)</div><div class="line">                <span class="keyword">for</span> i, srcimg := <span class="keyword">range</span> inGif.Image &#123;</div><div class="line">                        img := image.NewRGBA(rect)</div><div class="line">                        subfn := strings.Split(fn, <span class="string">"."</span>)[<span class="number">0</span>] + fmt.Sprintf(format, i) + <span class="string">".png"</span></div><div class="line">                        f, err := os.Create(subfn)</div><div class="line">                        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                                <span class="built_in">panic</span>(err)</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">defer</span> f.Close(</div><div class="line">                        draw.Draw(img, srcimg.Bounds(), srcimg, srcimg.Rect.Min, draw.Src)</div><div class="line">                        fmt.Printf(<span class="string">"\r%s"</span>, subfn)</div><div class="line">                        png.Encode(f, img)</div><div class="line">                &#125;</div><div class="line">                fmt.Println(<span class="string">"\r"</span>, fn)</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre> </td>
                  </tr>
                </table>
              </figure>
              <blockquote> <a href="https://gist.github.com/linw1995/820b05ac3fbab34937635d30a61740fb#file-gif2png-go" target="_blank" rel="external">img2gif.go | Gist</a> </blockquote>
              <h2 id="代码解析">
                <a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h2>
              <ul>
                <li><code>func Draw(dst Image, r image.Rectangle, src image.Image, sp image.Point, op Op)</code><br>是<code>&quot;image/draw&quot;</code>包中的一个函数，作用是把scr图以sp点起点开始的区域，根据op修改后，覆盖到dst图的r区域上。<br>在以上的代码中作用是图像格式转换，GIF拆分子图。</li>
                <li><code>draw.Src</code> 是<code>&quot;image/draw&quot;</code>包中的一个常量，代表操作：源图像透过遮罩后，替换掉目标图像。<br><code>draw.Over</code> 代表操作：源图像透过遮罩后，覆盖在目标图像上（类似图层）。</li>
                <li><code>image.ZP</code> 为<code>&quot;image&quot;</code>包中的一个常量，代表图片原点位置</li>
              </ul>
              <h2 id="Gallery">
                <a href="#Gallery" class="headerlink" title="Gallery"></a>Gallery</h2>
              <p>无聊时随便搞得几个动图</p> <img src="/2017/06/06/Use-go-to-manipulate-gif/AnimationExample01.gif" alt="&nbsp;" title="&nbsp;"> <img src="/2017/06/06/Use-go-to-manipulate-gif/AnimationExample02.gif" alt="&nbsp;" title="&nbsp;">
              <h2 id="参考">
                <a href="#参考" class="headerlink" title="参考"></a>参考</h2>
              <blockquote class="pullquote">
                <ul>
                  <li><a href="https://blog.golang.org/go-imagedraw-package" target="_blank" rel="external">The Go image/draw package | The Go Blog</a></li>
                </ul>
              </blockquote>
            </div>
            <script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://linw1995.com/2017/06/06/Use-go-to-manipulate-gif/" data-id="cj4o96wcd000jositx2k2ud3k" class="article-share-link">Share</a>
            <div class="tags"><a href="/tags/Go/">Go</a></div>
            <div class="post-nav"><a href="/2017/06/16/iOS字体安装和使用/" class="pre">iOS字体安装和使用</a><a href="/2017/05/21/蒙特卡洛方法及应用/" class="next">蒙特卡洛方法及应用</a></div>
            <div id="disqus_thread">
              <div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div>
              <script>
                var disqus_shortname = 'linw1995';
                var disqus_identifier = '2017/06/06/Use-go-to-manipulate-gif/';
                var disqus_title = 'Use go to manipulate gif';
                var disqus_url = 'http://linw1995.com/2017/06/06/Use-go-to-manipulate-gif/';
                $('.btn_click_load').click(function() {
                  (function() {
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript';
                    dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
                  $('.btn_click_load').css('display', 'none');
                });
                $.ajax({
                  url: 'https://disqus.com/favicon.ico',
                  timeout: 3000,
                  type: 'GET',
                  success: (function() {
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript';
                    dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    $('.btn_click_load').css('display', 'none');
                  })(),
                  error: function() {
                    $('.btn_click_load').css('display', 'block');
                  }
                });
              </script>
              <script id="dsq-count-scr" src="//linw1995.disqus.com/count.js" async></script>
            </div>
          </div>
        </div>
      </div>
      <div class="pure-u-1 pure-u-md-4-4">
        <div id="footer">Copyright © 2017 <a href="/." rel="nofollow">linw1995.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow"
            target="_blank" href="https://github.com/pagecho"> Cho.</a></div>
      </div>
    </div>
    <a id="rocket" href="#top" class="show"></a>
    <script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script>
    <script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script>
    <script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script>
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css">
    <script type="text/javascript" src="/js/search.js?v=0.0.0"></script>
    <script>
      var search_path = 'search.xml';
      if (search_path.length == 0) {
        search_path = 'search.xml';
      }
      var path = '/' + search_path;
      searchFunc(path, 'local-search-input', 'local-search-result');
    </script>
    <script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script>
    <script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script>
  </div>
</body>

</html>